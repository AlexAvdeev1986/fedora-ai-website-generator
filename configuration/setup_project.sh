#!/bin/bash
PROJECT_DIR="/opt/fedora-website-generator"

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ Fedora AI Website Generator"

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p $PROJECT_DIR/{backend,frontend,logs,uploads,generated,cache,static}

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Ñ–∞–π–ª—ã —É–∂–µ —Ç–∞–º)
cd $PROJECT_DIR

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Python –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.11 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r backend/requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
cd frontend
npm install
npm run build

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cd $PROJECT_DIR
cp configuration/.env.example .env

echo "üìù –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: nano .env"
echo "üîë –ü–æ–ª—É—á–∏—Ç–µ OpenAI API –∫–ª—é—á: https://platform.openai.com/api-keys"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞
sudo cp backend/systemd/fedora-website-generator.service /etc/systemd/system/
sudo systemctl daemon-reload

echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üöÄ –ó–∞–ø—É—Å–∫: sudo systemctl start fedora-website-generator"
echo "üìä –°—Ç–∞—Ç—É—Å: sudo systemctl status fedora-website-generator"
